var products = [
    {
        image: 'img-1-1.png',
        name: 'Cơm Cá Đỏ Sốt Teriyaki',
        price: '99,000',
        type: 'bento',
        masp: 'bento0'
    },
    {
        image: 'img-1-2.png',
        name: 'Cơm Bento Thịt Heo Chiên Xù Sốt Tonkatsu',
        price: '99,000',
        type: 'bento',
        masp: 'bento1'
    },
    {
        image: 'img-1-6.png',
        name: 'Cơm Cá Hồi Sốt Teriyaki',
        price: '159,000',
        type: 'bento',
        masp: 'bento2'
    },
    {
        image: 'img-1-7.png',
        name: 'Cơm Tôm Chiên Xù',
        price: '169,000',
        type: 'bento',
        masp: 'bento3'
    },
    {
        image: 'img-1-8.png',
        name: 'Cơm Hải Sản',
        price: '169,000',
        type: 'bento',
        masp: 'bento4'
    },
    {
        image: 'img-1-9.png',
        name: 'Cơm Lươn Nhật',
        price: '189,000',
        type: 'bento',
        masp: 'bento5'
    },
    {
        image: 'img-1-1.png',
        name: 'Cơm Cá Đỏ Sốt Teriyaki',
        price: '99,000',
        type: 'bento',
        masp: 'bento6'
    },
    {
        image: 'img-1-2.png',
        name: 'Cơm Bento Thịt Heo Chiên Xù Sốt Tonkatsu',
        price: '99,000',
        type: 'bento',
        masp: 'bento7'
    },
    {
        image: 'img-1-6.png',
        name: 'Cơm Cá Hồi Sốt Teriyaki',
        price: '159,000',
        type: 'bento',
        masp: 'bento8'
    },
    {
        image: 'img-1-7.png',
        name: 'Cơm Tôm Chiên Xù',
        price: '169,000',
        type: 'bento',
        masp: 'bento9'
    },
    {
        image: 'img-1-8.png',
        name: 'Cơm Hải Sản',
        price: '169,000',
        type: 'bento',
        masp: 'bento10'
    },
    {
        image: 'img-1-9.png',
        name: 'Cơm Lươn Nhật',
        price: '189,000',
        type: 'bento',
        masp: 'bento11'
    },
    {
        image: 'img-0-1.png',
        name: 'Tempura Roll',
        price: '118,000',
        type: 'sushi',
        masp: 'sushi0'
    },
    {
        image: 'img-0-2.png',
        name: 'Grilled Salmon Roll',
        price: '129,000',
        type: 'sushi',
        masp: 'sushi1'
    },
    {
        image: 'img-0-3.png',
        name: 'Kani Crunchy Roll',
        price: '153,000',
        type: 'sushi',
        masp: 'sushi2'
    },
    {
        image: 'img-1-1.png',
        name: 'Cơm Cá Đỏ Sốt Teriyaki',
        price: '99,000',
        type: 'bento',
        masp: 'bento12'
    },
    {
        image: 'img-0-4.png',
        name: 'Soft Shell Crab Roll',
        price: '168,000',
        type: 'sushi',
        masp: 'sushi3'
    },
    {
        image: 'img-0-5.png',
        name: 'Avocado Roll',
        price: '95,000',
        type: 'sushi',
        masp: 'sushi4'
    },
    {
        image: 'img-0-6.png',
        name: 'Tokachi Grilled Roll',
        price: '159,000',
        type: 'sushi',
        masp: 'sushi5'
    },
    {
        image: 'img-0-7.png',
        name: 'Unagi Roll',
        price: '280,000',
        type: 'sushi',
        masp: 'sushi6'
    },
    {
        image: 'img-0-8.png',
        name: 'Spicy Ebi Roll',
        price: '118,000',
        type: 'sushi',
        masp: 'sushi7'
    },
    {
        image: 'img-0-9.png',
        name: 'Cơm Cuộn Rồng Xanh',
        price: '79,000',
        type: 'sushi',
        masp: 'sushi8'
    },
    {
        image: 'img-0-10.png',
        name: 'Cơm Cuộn California',
        price: '139,000',
        type: 'sushi',
        masp: 'sushi9'
    },
    {
        image: 'img-0-11.png',
        name: 'Cơm Cuộn Cá Hồi Nướng Tái',
        price: '139,000',
        type: 'sushi',
        masp: 'sushi10'
    },
    {
        image: 'img-0-12.png',
        name: 'Cơm Cuộn Tôm Chiên Tempura',
        price: '179,000',
        type: 'sushi',
        masp: 'sushi11'
    },
    {
        image: 'img-0-13.png',
        name: 'Cơm Cuộn Cầu Vồng',
        price: '179,000',
        type: 'sushi',
        masp: 'sushi12'
    },
    {
        image: 'img-0-14.png',
        name: 'Cơm Cuộn Lươn Phô Mai',
        price: '199,000',
        type: 'sushi',
        masp: 'sushi13'
    },
    {
        image: 'img-0-15.png',
        name: 'Cơm Cuộn Hải Sản',
        price: '199,000',
        type: 'sushi',
        masp: 'sushi14'
    },
    {
        image: 'img-2-1.png',
        name: 'Sashimi Ốc Bulot Ireland',
        price: '189,000',
        type: 'sashi',
        masp: 'sashi0'
    },
    {
        image: 'img-2-2.png',
        name: 'Sashimi Cá Chim Việt Nam',
        price: '199,000',
        type: 'sashi',
        masp: 'sashi1'
    },
    {
        image: 'img-2-3.png',
        name: 'Sashimi Cá Mú Việt Nam',
        price: '219,000',
        type: 'sashi',
        masp: 'sashi2'
    },
    {
        image: 'img-2-4.png',
        name: 'Sashimi Tôm Sú Việt Nam',
        price: '249,000',
        type: 'sashi',
        masp: 'sashi3'
    },
    {
        image: 'img-2-5.png',
        name: 'Sashimi Cá Bơn Hàn Quốc',
        price: '399,000',
        type: 'sashi',
        masp: 'sashi4'
    },
    {
        image: 'img-2-6.png',
        name: 'Sashimi Bào Ngư Hàn Quốc',
        price: '499,000',
        type: 'sashi',
        masp: 'sashi5'
    },
    {
        image: 'img-2-7.png',
        name: 'Sashimi Ốc Vòi Voi',
        price: '889,000',
        type: 'sashi',
        masp: 'sashi6'
    },
    {
        image: 'img-2-8.png',
        name: 'Sashimi Bạch Tuộc',
        price: '169,000',
        type: 'sashi',
        masp: 'sashi7'
    },
    {
        image: 'img-2-9.png',
        name: 'Sashimi Trứng Cá Hồi',
        price: '239,000',
        type: 'sashi',
        masp: 'sashi8'
    },
    {
        image: 'img-2-10.png',
        name: 'Sashimi Bụng Cá Cam',
        price: '299,000',
        type: 'sashi',
        masp: 'sashi9'
    },
    {
        image: 'img-2-11.png',
        name: 'Sashimi Bụng Cá Hồi',
        price: '219,000',
        type: 'sashi',
        masp: 'sashi10'
    },
    {
        image: 'img-2-12.png',
        name: 'Sashimi Cá Trích Ép Trứng Đỏ',
        price: '169,000',
        type: 'sashi',
        masp: 'sashi11'
    },
    {
        image: 'img-2-13.png',
        name: 'Sashimi Cá Trích Ép Trứng Vàng',
        price: '169,000',
        type: 'sashi',
        masp: 'sashi12'
    },
    {
        image: 'img-2-14.png',
        name: 'Sashimi Cồi Sò Điệp Nhật',
        price: '239,000',
        type: 'sashi',
        masp: 'sashi13'
    },
    {
        image: 'img-2-15.png',
        name: 'Sashimi Sò Đỏ Hokkigai',
        price: '239,000',
        type: 'sashi',
        masp: 'sashi14'
    },
    {
        image: 'img-2-16.png',
        name: 'Sashimi Trứng Cá Chuồn',
        price: '169,000',
        type: 'sashi',
        masp: 'sashi15'
    },
    {
        image: 'img-2-17.png',
        name: 'Sashimi Thân Cá Hồi',
        price: '199,000',
        type: 'sashi',
        masp: 'sashi16'
    },
    {
        image: 'img-2-2.png',
        name: 'Sashimi Cá Chim Việt Nam',
        price: '199,000',
        type: 'sashi',
        masp: 'sashi17'
    },
    {
        image: 'img-2-4.png',
        name: 'Sashimi Tôm Sú Việt Nam',
        price: '249,000',
        type: 'sashi',
        masp: 'sashi18'
    },
    {
        image: 'img-2-6.png',
        name: 'Sashimi Bào Ngư Hàn Quốc',
        price: '499,000',
        type: 'sashi',
        masp: 'sashi19'
    },
    {
        image: 'img-2-8.png',
        name: 'Sashimi Bạch Tuộc',
        price: '169,000',
        type: 'sashi',
        masp: 'sashi20'
    },
    {
        image: 'img-2-10.png',
        name: 'Sashimi Bụng Cá Cam',
        price: '299,000',
        type: 'sashi',
        masp: 'sashi21'
    },
    {
        image: 'img-3-1.png',
        name: 'Combo Sashimi 3A',
        price: '269,000',
        type: 'combo',
        masp: 'combo0'
    },
    {
        image: 'img-3-2.png',
        name: 'Combo Sashimi 3B',
        price: '289,000',
        type: 'combo',
        masp: 'combo1'
    },
    {
        image: 'img-3-3.png',
        name: 'Combo Sashimi 3C',
        price: '319,000',
        type: 'combo',
        masp: 'combo2'
    },
    {
        image: 'img-3-4.png',
        name: 'Combo Sashimi 3D',
        price: '349,000',
        type: 'combo',
        masp: 'combo3'
    },
    {
        image: 'img-3-5.png',
        name: 'Combo Sashimi 3E',
        price: '389,000',
        type: 'combo',
        masp: 'combo4'
    },
    {
        image: 'img-3-6.png',
        name: 'Combo Sashimi 3F',
        price: '598,000',
        type: 'combo',
        masp: 'combo5'
    },
    {
        image: 'img-3-7.png',
        name: 'Combo Sashimi 5A',
        price: '499,000',
        type: 'combo',
        masp: 'combo6'
    },
    {
        image: 'img-3-8.png',
        name: 'Combo Sashimi 5B',
        price: '549,000',
        type: 'combo',
        masp: 'combo7'
    },
    {
        image: 'img-3-9.png',
        name: 'Combo Sashimi 5C',
        price: '849,000',
        type: 'combo',
        masp: 'combo8'
    },
    {
        image: 'img-3-10.png',
        name: 'Combo Sashimi 5D',
        price: '749,000',
        type: 'combo',
        masp: 'combo9'
    },
    {
        image: 'img-3-11.png',
        name: 'Combo Sashimi 7A',
        price: '999,000',
        type: 'combo',
        masp: 'combo10'
    },
    {
        image: 'img-3-12.png',
        name: 'Combo Sashimi 7B',
        price: '999,000',
        type: 'combo',
        masp: 'combo11'
    },
    {
        image: 'img-3-13.png',
        name: 'Combo Sashimi 7C',
        price: '990,000',
        type: 'combo',
        masp: 'combo12'
    },
    {
        image: 'img-3-14.png',
        name: 'Combo Sashimi Hoàng Gia',
        price: '2,249,000',
        type: 'combo',
        masp: 'combo13'
    },
    {
        image: 'img-4-1.png',
        name: 'Bánh Xèo Nhật',
        price: '89,000',
        type: 'ankem',
        masp: 'ankem0'
    },
    {
        image: 'img-4-2.png',
        name: 'Cá Hồi Sốt Teriyaki',
        price: '99,000',
        type: 'ankem',
        masp: 'ankem1'
    },
    {
        image: 'img-4-3.png',
        name: 'Đậu Nành Nhật',
        price: '35,000',
        type: 'ankem',
        masp: 'ankem2'
    },
    {
        image: 'img-4-4.png',
        name: 'Gừng Hồng',
        price: '10,000',
        type: 'ankem',
        masp: 'ankem3'
    },
    {
        image: 'img-4-5.png',
        name: 'Lá Tía Tô',
        price: '10,000',
        type: 'ankem',
        masp: 'ankem4'
    },
    {
        image: 'img-4-6.png',
        name: 'Lẩu Hải Sản Cay',
        price: '399,000',
        type: 'ankem',
        masp: 'ankem5'
    },
    {
        image: 'img-4-7.png',
        name: 'Mì Udon Hải Sản Cay',
        price: '199,000',
        type: 'ankem',
        masp: 'ankem6'
    },
    {
        image: 'img-4-8.png',
        name: 'Rong Nho',
        price: '99,000',
        type: 'ankem',
        masp: 'ankem7'
    },
    {
        image: 'img-4-9.png',
        name: 'Salad Cá Hồi Da Giòn',
        price: '119,000',
        type: 'ankem',
        masp: 'ankem8'
    },
    {
        image: 'img-4-10.png',
        name: 'Salad Hải Sản Sốt Hành Tây',
        price: '169,000',
        type: 'ankem',
        masp: 'ankem9'
    },
    {
        image: 'img-4-11.png',
        name: 'Salad Wakame',
        price: '69,000',
        type: 'ankem',
        masp: 'ankem10'
    },
    {
        image: 'img-4-12.png',
        name: 'Soup Miso Đầu Cá Bơn',
        price: '79,000',
        type: 'ankem',
        masp: 'ankem11'
    },
    {
        image: 'img-4-13.png',
        name: 'Soup Miso Đầu Cá Chim',
        price: '79,000',
        type: 'ankem',
        masp: 'ankem12'
    },
    {
        image: 'img-4-14.png',
        name: 'Soup Miso Đầu Cá Hồi',
        price: '79,000',
        type: 'ankem',
        masp: 'ankem13'
    },
    {
        image: 'img-4-15.png',
        name: 'Wasabi Tươi',
        price: '10,000',
        type: 'ankem',
        masp: 'ankem14'
    },
    {
        image: 'img-5-1.png',
        name: 'Coca-Cola',
        price: '10,000',
        type: 'douong',
        masp: 'douong0'
    },
    {
        image: 'img-5-2.png',
        name: 'Nước Suối Dasani',
        price: '10,000',
        type: 'douong',
        masp: 'douong1'
    },
    {
        image: 'img-5-3.png',
        name: 'Tàu Hủ Tươi Sentofu - Vị Đào',
        price: '19,000',
        type: 'douong',
        masp: 'douong2'
    },
    {
        image: 'img-5-4.png',
        name: 'Tàu Hủ Tươi Sentofu - Vị Dâu',
        price: '19,000',
        type: 'douong',
        masp: 'douong3'
    },
    {
        image: 'img-5-5.png',
        name: 'Tàu Hủ Tươi Sentofu - Vị Lá Dứa',
        price: '19,000',
        type: 'douong',
        masp: 'douong4'
    },
    {
        image: 'img-5-6.png',
        name: 'Tàu Hủ Tươi Sentofu - Vị Truyền Thống',
        price: '19,000',
        type: 'douong',
        masp: 'douong5'
    },
    {
        image: 'img-5-7.png',
        name: 'Tàu Hủ Tươi Sentofu - Vị Việt Quất',
        price: '19,000',
        type: 'douong',
        masp: 'douong6'
    }
]

const Products = localStorage.getItem('product') ? JSON.parse(localStorage.getItem('product')) : products;

if(Products === products) {
    localStorage.setItem("product", JSON.stringify(Products))
}

var accounts = [
    {
        isAdmin: false,
        isUser: false,
        isLogout: true,
        Fullname: 'user',
        Username: 'user',
        Password: 'user'
    },
    {
        Fullname: 'Admin',
        Password: 'admin',
        Username: 'admin',
        email: 'admin@gmail.com',
        ngaydangky: '27-11-2022',
        cart: [],
        donhang: []
    }
]

// Set mặc định cho arr (account)
const Arr = localStorage.getItem('account') ? JSON.parse(localStorage.getItem('account')) : accounts;

if(Arr === accounts) {
    localStorage.setItem("account", JSON.stringify(accounts))
}



if(Arr[0].isAdmin) {
// ==> PHẦN CHUNG
// Lựa chọn các item trên nav-item
const navItems = document.querySelectorAll('.nav-item');
const sectionItems = document.querySelectorAll('.section > div');
navItems.forEach(function(navItem, index) {
    navItem.onclick = function() {
        document.querySelector('.nav-item.active').classList.remove('active');
        navItem.classList.add('active');

        sectionItems.forEach(function(sectionItem) {
            sectionItem.style.display = 'none';
        })

        switch(index) {
            case 0:
                document.querySelector('.section__home').style.display = "block";
                break;
            case 1:
                document.querySelector('.section__product').style.display = "block";
                break;
            case 2:
                document.querySelector('.section__order').style.display = "block";
                break;
            case 3:
                document.querySelector('.section__customer').style.display = "block";
                break;
        }
    }
})

// Cắt ảnh
function splitImg(img) {
    var img2 = img.split('fakepath\\');
    if(img2.length === 1) {
        return img2;
    }
    else {
        return img2[1];
    }
}

// Ghép ảnh
function collageImg(img) {
    return './images/' + img;
}

// Chuyển định dạng cho ngày tháng năm (yyyy-mm-dd)
function parseYMD(string) {
    let arr = string.split("-");
    if (arr[0] < 10) {
        arr[0] = `0${arr[0]}`;
    }
    return arr[2] + "-" + arr[1] + "-" + arr[0]
}

// Thêm dấu phẩy
function addComma(number) {
    number = '' + number;
    if (number.length > 3) {
        var mod = number.length % 3;
        var output = (mod > 0 ? (number.substring(0,mod)) : '');
        for (i=0 ; i < Math.floor(number.length / 3); i++) {
            if ((mod == 0) && (i == 0))
                output += number.substring(mod+ 3 * i, mod + 3 * i + 3);
            else
                output+= ',' + number.substring(mod + 3 * i, mod + 3 * i + 3);
        }
        return (output);
    }
    else return number;
}

// Xóa dấu phẩy
function deleteComma(s) {
    var arr = s.split(',');
    var money = '';
    for(let i=0; i < arr.length; i++) {
        money += arr[i];
    }

    return parseInt(money);
}

// Hàm lấy Loại sản phẩm
function getTypeProduct(type) {
    var a = ["Bento", "Sushi", "Sashimi", "Combo Sashimi", "Món ăn kèm", "Nước uống và tráng miệng"]
    var s;
    switch(type) {
        case 'bento':
            s = a[0];
            break;
        case 'sushi':
            s = a[1];
            break;
        case 'sashi':
            s = a[2];
            break;
        case 'combo':
            s = a[3];
            break;
        case 'ankem':
            s = a[4];
            break;
        case 'douong':
            s = a[5];
            break;
    }

    return s;
}



// ==> BẢNG SẢN PHẨM
// ** Hiển thị sản phẩm
function showProduct() {
    const arr = localStorage.getItem('product') ? JSON.parse(localStorage.getItem('product')) : products;
    var htmls = '<table>';
    arr.map((item, index) => {
        htmls += `
                <tr>
                    <td style="width: 5%">${index+1}</td>
                    <td style="width: 10%">${arr[index].masp}</td>
                    <td style="width: 10%">${getTypeProduct(item.type)}</td>
                    <td style="width: 35%" class="fa__left">${item.name}</td>
                    <td style="width: 15%">${item.price}</td>
                    <td style="width: 15%"><img src="${collageImg(item.image)}"></td>
                    <td style="width: 10%">
                        <div class="tooltip update" onclick="editProduct(${index})">
                            <i class="fa fa-wrench"></i>
                            <span class="tooltiptext">Sửa</span>
                        </div>
                        <div class="tooltip delete" onclick="deleteProduct(${index})">
                            <i class="fa fa-trash"></i>
                            <span class="tooltiptext">Xóa</span>
                        </div>
                    </td>
                </tr>`
            return htmls;
    })
    htmls += '</table>';
    document.getElementById('table-product').innerHTML = htmls;
}

// ** Xử lý thêm sản phẩm
const addProductBtn = document.getElementById('add-product');
const overlayProduct = document.querySelector('.overlay.product.add');
const overlayProduct2 = document.querySelector('.overlay.product.edit');
const confirmAdd = document.getElementById('add-btn');
const valueType = document.querySelector('.overlay.product select');
const nameProduct = document.querySelector('.overlay.product input.name');
const imgProduct = document.querySelector('.overlay.product input[type="file"]');
const priceProduct = document.querySelector('.overlay.product input.price');
const notify = document.querySelector('.notify');

// clear
function clear() {
    imgProduct.value = "";
    document.getElementById('productImgAdd').src = "";
    nameProduct.value = "";
    priceProduct.value = "";
    valueType.value = "bento";
}

function addProduct() {
    addProductBtn.addEventListener('click', function() {
        overlayProduct.style.transform = 'scale(1)';
        autoMaSanPham();
    })
    
    confirmAdd.onclick = function() {
        const arr = localStorage.getItem('product') ? JSON.parse(localStorage.getItem('product')) : products;
        const image = splitImg(imgProduct.value);
        const name = nameProduct.value;
        const price = priceProduct.value;
        const type = valueType.value;
        const masp = document.getElementById('maspThem').value

        if(imgProduct.value != "" && name != "" && price != "" && masp != '') {
            // Kiểm tra có trùng mã hoặc tên
            var check = true;
            for(let i=0; i < arr.length; i++) {
                if(arr[i].name == name) {
                    setTimeout(function() {
                        notify.style.transform = 'translateX(0)';
                        notify.style.opacity = '1';
                        notify.innerHTML = `<div class="login-notify error">
                                                <i class="fa-solid fa-circle-xmark"></i>
                                                Tên sản phẩm bị trùng !!
                                            </div>`;
                        
                    }, 200)
            
                    setTimeout(function() {
                        notify.style.transform = 'translateX(100%)';
                        notify.style.opacity = '0';
                    }, 2000)

                    check = false;
                }
        
                if(arr[i].masp == masp) {
                    setTimeout(function() {
                        notify.style.transform = 'translateX(0)';
                        notify.style.opacity = '1';
                        notify.innerHTML = `<div class="login-notify error">
                                                <i class="fa-solid fa-circle-xmark"></i>
                                                Mã sản phẩm bị trùng !!
                                            </div>`;
                        
                    }, 200)
            
                    setTimeout(function() {
                        notify.style.transform = 'translateX(100%)';
                        notify.style.opacity = '0';
                        return ;
                    }, 2000)

                    check = false;
                }

                if(isNaN(price)) {
                    setTimeout(function() {
                        notify.style.transform = 'translateX(0)';
                        notify.style.opacity = '1';
                        notify.innerHTML = `<div class="login-notify error">
                                                <i class="fa-solid fa-circle-xmark"></i>
                                                Giá sản phẩm phải là chữ số !!
                                            </div>`;
                        
                    }, 200)
            
                    setTimeout(function() {
                        notify.style.transform = 'translateX(100%)';
                        notify.style.opacity = '0';
                        return ;
                    }, 2000)

                    check = false;
                }
            }

            if(check === true) {
                arr.push({
                    image: image,
                    name: name,
                    price: addComma(price),
                    type: type,
                    masp: masp
                })
                
                localStorage.setItem("product", JSON.stringify(arr));

                setTimeout(function() {
                    notify.style.transform = 'translateX(0)';
                    notify.style.opacity = '1';
                    notify.innerHTML = `<div class="login-notify success">
                                            <i class="fa-sharp fa-solid fa-circle-check"></i>
                                            Thêm sản phẩm thành công
                                        </div>`;
                }, 200)
                
                setTimeout(function() {
                    notify.style.transform = 'translateX(100%)';
                    notify.style.opacity = '0';
                }, 2000)
                
                setTimeout(function() {
                    overlayProduct.style.transform = 'scale(0)';
                }, 1300)

                clear();
                showProduct();
                // renderPage();
                // changePage();
            }
        }
        else {
            setTimeout(function() {
                notify.style.transform = 'translateX(0)';
                notify.style.opacity = '1';
                notify.innerHTML = `<div class="login-notify error">
                                        <i class="fa-solid fa-circle-xmark"></i>
                                        Chưa điền đủ thông tin sản phẩm !!
                                    </div>`;
                
            }, 200)
    
            setTimeout(function() {
                notify.style.transform = 'translateX(100%)';
                notify.style.opacity = '0';
            }, 2000)
        }
        notify.innerHTML = '';
    }
    
}
addProduct();

// ** Xử lý xóa sản phẩm
const notifyDelete = document.querySelectorAll('.notify__delete')[0];
function deleteProduct(i) {
    notifyDelete.innerHTML = `<div class="notify__delete-text">
                Bạn có chắc sẽ xóa sản phẩm này không?
            </div>
            <div class="notify__delete-btn">
                <div class="notify__delete-ok">
                    OK
                </div>
                <div class="notify__delete-cancel">
                    Hủy
                </div>
            </div>`

    notifyDelete.style.transform = 'translate(-50%, 0)';
    notifyDelete.style.opacity = '1';
    document.querySelector('.notify__delete-ok').onclick = function() {
        const arr = localStorage.getItem('product') ? JSON.parse(localStorage.getItem('product')) : products;
        notifyDelete.style.transform = 'translate(-50%, -270%)';
        notifyDelete.style.opacity = '0';

        arr.splice(i, 1);

        localStorage.setItem("product", JSON.stringify(arr));
        
        showProduct();
        // renderPage();
        // changePage();
    }

    document.querySelector('.notify__delete-cancel').onclick = function() {
        notifyDelete.style.transform = 'translate(-50%, -270%)';
        notifyDelete.style.opacity = '0';
    }
    
}

// Hiện ảnh khi chọn file
function updateProductImg(files, id) {
    const reader = new FileReader();
    reader.addEventListener("load", function () {
        // convert image file to base64 string
        previewSrc = reader.result;
        document.getElementById(id).src = previewSrc;
    }, false);

    if (files[0]) {
        reader.readAsDataURL(files[0]);
    }
}

// hàm tự tạo mã cho sản phẩm mới thêm
function autoMaSanPham(sp) {
    const arr = localStorage.getItem('product') ? JSON.parse(localStorage.getItem('product')) : products;

    if(!sp)
        sp = document.getElementsByName('selectProduct')[0].value;
    var index = 0;
    for (var i = 0; i < arr.length; i++) {
        if (arr[i].type == sp) {
            index++;
        }
    }
    document.getElementById('maspThem').value = sp.substring(0, 6) + index;
}

// ** Xử lý sửa sản phẩm
// hàm tự tạo mã cho sản phẩm mới sửa
function autoMaSanPham2(sp) {
    const arr = localStorage.getItem('product') ? JSON.parse(localStorage.getItem('product')) : products;

    if(!sp)
        sp = document.getElementsByName('selectProduct2')[0].value;
    var index = 0;
    for (var i = 0; i < arr.length; i++) {
        if (arr[i].type == sp) {
            index++;
        }
    }
    document.getElementById('maspSua').value = sp.substring(0, 6) + index;
}

function editProduct(i) {
    const arr = localStorage.getItem('product') ? JSON.parse(localStorage.getItem('product')) : products;
    var htmls = `
    <div class="close" onclick="this.parentElement.style.transform = 'scale(0)';">
                        <i class="fa-solid fa-xmark"></i>
                    </div>
                    <table class="overlayTable table-outline table-content table-header">
                        <tr>
                            <th colspan="2">Xóa Sản Phẩm</th>
                        </tr>
                        <tr>
                            <td>Mã sản phẩm:</td>
                            <td><input type="text" id="maspSua" value="${arr[i].masp}"></td>
                        </tr>
                        <tr>
                            <td>Loại sản phẩm:</td>
                            <td>
                                <select name="selectProduct2" onchange="autoMaSanPham2(this.value)">`

    var tmps = ["bento", "sushi", "sashi", "combo", "ankem", "douong"];
    for(var tmp of tmps) {
        if(arr[i].type === tmp)
            htmls += (`<option value="`+tmp+`" selected>`+getTypeProduct(tmp)+`</option>`);
        else
            htmls += (`<option value="`+tmp+`">`+getTypeProduct(tmp)+`</option>`);
    }
    
    htmls += `</select>
                </td>
            </tr>
            <tr>
                <td>Tên sản phẩm:</td>
                <td><input type="text" class="name" value="${arr[i].name}"></td>
            </tr>
            <tr>
                <td>Hình ảnh:</td>
                <td>
                    <img src="${collageImg(arr[i].image)}" id="productImgEdit">
                    <input type="file" name="" id="" onchange="updateProductImg(this.files, 'productImgEdit')">
                </td>
            </tr>
            <tr>
                <td>Giá tiền:</td>
                <td><input type="text" class="price" value="${deleteComma(arr[i].price)}"></td>
            </tr>
            <tr>
                <td colspan="2" class="table-footer">
                    <button id="edit-btn">SỬA</button>
                </td>
            </tr>
        </table>`

    var maspTmp = arr[i].masp;
    var tenspTmp = arr[i].name;
    document.querySelector('.overlay.product.edit').innerHTML = htmls;
    overlayProduct2.style.transform = 'scale(1)';

    const editBtn = document.getElementById('edit-btn');
    
    editBtn.onclick = function() {
        const type = document.querySelector('.overlay.product.edit select').value;
        const name = document.querySelector('.overlay.product.edit input.name').value;
        const image1 = document.getElementById('productImgEdit').src;
        const price = document.querySelector('.overlay.product.edit input.price').value;
        const masp = document.getElementById('maspSua').value;
        const image2 = document.querySelector('.overlay.product.edit input[type="file"]').value;

        var image;

        if(image2 == '') {
            image = image1.split('/images/')[1];
        }
        else {
            image = splitImg(image2);
        }
    
        if(name != "" && price != "" && masp != "") {
            // Kiểm tra có trùng mã hoặc tên
            var check = true;
            for(let i=0; i < arr.length; i++) {
                if(arr[i].name == name && name != tenspTmp) {
                    setTimeout(function() {
                        notify.style.transform = 'translateX(0)';
                        notify.style.opacity = '1';
                        notify.innerHTML = `<div class="login-notify error">
                                                <i class="fa-solid fa-circle-xmark"></i>
                                                Tên sản phẩm bị trùng !!
                                            </div>`;
                        
                    }, 200)
            
                    setTimeout(function() {
                        notify.style.transform = 'translateX(100%)';
                        notify.style.opacity = '0';
                    }, 2000)

                    check = false;
                }
        
                if(arr[i].masp == masp && masp != maspTmp) {
                    setTimeout(function() {
                        notify.style.transform = 'translateX(0)';
                        notify.style.opacity = '1';
                        notify.innerHTML = `<div class="login-notify error">
                                                <i class="fa-solid fa-circle-xmark"></i>
                                                Mã sản phẩm bị trùng !!
                                            </div>`;
                        
                    }, 200)
            
                    setTimeout(function() {
                        notify.style.transform = 'translateX(100%)';
                        notify.style.opacity = '0';
                        return ;
                    }, 2000)

                    check = false;
                }

                if(isNaN(price)) {
                    setTimeout(function() {
                        notify.style.transform = 'translateX(0)';
                        notify.style.opacity = '1';
                        notify.innerHTML = `<div class="login-notify error">
                                                <i class="fa-solid fa-circle-xmark"></i>
                                                Giá sản phẩm phải là chữ số !!
                                            </div>`;
                        
                    }, 200)
            
                    setTimeout(function() {
                        notify.style.transform = 'translateX(100%)';
                        notify.style.opacity = '0';
                        return ;
                    }, 2000)

                    check = false;
                }
            }

            if(check === true) {
                arr[i] = {
                    image: image,
                    name: name,
                    price: addComma(price),
                    type: type,
                    masp: masp
                }
                
                setTimeout(function() {
                    notify.style.transform = 'translateX(0)';
                    notify.style.opacity = '1';
                    notify.innerHTML = `<div class="login-notify success">
                                            <i class="fa-solid fa-circle-check"></i>
                                            Sửa sản phẩm thành công
                                        </div>`;
                }, 200)
                
                setTimeout(function() {
                    notify.style.transform = 'translateX(100%)';
                    notify.style.opacity = '0';
                }, 2000)
                
                setTimeout(function() {
                    overlayProduct2.style.transform = 'scale(0)';
                }, 1300)
                
                // changePage();
                // renderPage();
                showProduct();
            }
        }
        else {
            setTimeout(function() {
                notify.style.transform = 'translateX(0)';
                notify.style.opacity = '1';
                notify.innerHTML = `<div class="login-notify error">
                                        <i class="fa-solid fa-circle-xmark"></i>
                                        Chưa điền đủ thông tin sản phẩm !!
                                    </div>`;
            }, 200)
    
            setTimeout(function() {
                notify.style.transform = 'translateX(100%)';
                notify.style.opacity = '0';
            }, 2000)
        }
        notify.innerHTML = '';

        localStorage.setItem("product", JSON.stringify(arr));

        // changePage();
        // renderPage();
        showProduct();

    }

}

// ** Tìm kiếm sản phẩm
// Tìm kiếm
function timKiemSanPham(inp) {
    var kieuTim = document.getElementsByName('kieuTimSanPham')[0].value;
    var text = inp.value;

    // mảng lưu vị trí cột
    var vitriKieuTim = {
        'ma':1,
        'ten':3
    }; 

    var dsSanPham = document.querySelector('.section__product').querySelector('.table-content').getElementsByTagName('tr');
    for (var sp of dsSanPham) {
        var tmp = sp.getElementsByTagName('td')[vitriKieuTim[kieuTim]].innerHTML.toLowerCase();

        if (tmp.indexOf(text.toLowerCase()) < 0) {
            sp.style.display = 'none';
        } else {
            sp.style.display = '';
        }
    }
}



// ==> BẢNG KHÁCH HÀNG
function renderUser() {
    const arrUser = localStorage.getItem('account') ? JSON.parse(localStorage.getItem('account')) : accounts;
    var htmls = '<table>';
    for (let i = 1; i < arrUser.length; i++) {
        htmls += ` <tr>
        <td style="width: 5%">${i}</td>
        <td style="width: 10%">${arrUser[i].ngaydangky}</td>
        <td style="width: 20%">${arrUser[i].Fullname}</td>
        <td style="width: 25%">${arrUser[i].email}</td>
        <td style="width: 15%">${arrUser[i].Username}</td>
        <td style="width: 20%">${arrUser[i].Password}</td>
        <td style="width: 5%">
            <div class="tooltip delete" onclick="deleteUser(${i})">
                <i class="fa fa-trash"></i>
                <span class="tooltiptext">Xóa</span>
            </div>
        </td>
        </tr>`
    }
    htmls += '</table>';
    document.querySelector('#User').innerHTML = htmls;
    localStorage.setItem('account', JSON.stringify(arrUser));
}
renderUser();

const notifyDelete2 = document.querySelectorAll('.notify__delete')[2];
function deleteUser(i) {
    if(i === 1) {
        notifyDelete2.innerHTML = `<div class="notify__delete-text" style="color: red;">
                Không thể xóa tài khoản ADMIN !!
            </div>`

        notifyDelete2.style.transform = 'translate(-50%, 0)';
        notifyDelete2.style.opacity = '1';

        setTimeout(function() {
            notifyDelete2.style.transform = 'translate(-50%, -270%)';
            notifyDelete2.style.opacity = '0';
        }, 1500)
    }
    else {
        notifyDelete2.innerHTML = `<div class="notify__delete-text">
                    Bạn có chắc sẽ xóa Khách Hàng này không?
                </div>
                <div class="notify__delete-btn">
                    <div class="notify__delete-ok">
                        OK
                    </div>
                    <div class="notify__delete-cancel">
                        Hủy
                    </div>
                </div>`
    
        notifyDelete2.style.transform = 'translate(-50%, 0)';
        notifyDelete2.style.opacity = '1';
        document.querySelector('.notify__delete-ok').onclick = function() {
            const arr = localStorage.getItem('account') ? JSON.parse(localStorage.getItem('account')) : accounts;
            notifyDelete2.style.transform = 'translate(-50%, -270%)';
            notifyDelete2.style.opacity = '0';
    
            arr.splice(i, 1);
    
            localStorage.setItem("account", JSON.stringify(arr));
            renderUser();
            renderOder();
        }
    
        document.querySelector('.notify__delete-cancel').onclick = function() {
            notifyDelete2.style.transform = 'translate(-50%, -270%)';
            notifyDelete2.style.opacity = '0';
        }
    }
}

// Tìm kiếm người dùng
function timKiemNguoiDung(inp) {
    var kieuTim = document.querySelector('.kieuTimKhachHang').value;
    var text = inp.value;

    // Lọc
    var vitriKieuTim = {
        'ten':2, 
        'email':3, 
        'taikhoan':4
    };

    var dsKhachHang = document.querySelector('.section__customer').querySelector('.table-content').getElementsByTagName('tr');
    for (var kh of dsKhachHang) {
        var tmp = kh.getElementsByTagName('td')[vitriKieuTim[kieuTim]].innerHTML.toLowerCase();

        if (tmp.indexOf(text.toLowerCase()) < 0) {
            kh.style.display = 'none';
        } else {
            kh.style.display = '';
        }
    }
}


// ==> BẢNG ĐƠN HÀNG
function renderOder() {
    const arrUser = localStorage.getItem('account') ? JSON.parse(localStorage.getItem('account')) : accounts;
    var htmls = '<table>';
    var tmp = 1;
    var switchColor;

    for (let i = 1; i < arrUser.length; i++) {
        for(let j = 0; j < arrUser[i].donhang.length; j++) {
            if(arrUser[i].donhang.length > 0) {

                if(arrUser[i].donhang[j].trangthai == 'Đã xử lý') {
                    switchColor = 'active';
                }
                else {
                    switchColor = '';
                }

                htmls += `<tr>
                            <td style="width: 5%">${tmp++}</td>
                            <td style="width: 10%">${arrUser[i].donhang[j].ngaymua}</td>
                            <td style="width: 20%">${arrUser[i].Fullname}</td>
                            <td style="width: 20%">${arrUser[i].donhang[j].tongtien}</td>
                            <td class="trangthai ${switchColor}" style="width: 15%">${arrUser[i].donhang[j].trangthai}</td>
                            <td style="width: 10%">
                                <div class="tooltip check" onclick="duyet(${i}, ${j}, true)">
                                    <i class="fa fa-check"></i>
                                    <span class="tooltiptext">Duyệt</span>
                                </div>
                                <div class="tooltip cancle" onclick="duyet(${i}, ${j}, false)">
                                    <i class="fa fa-remove"></i>
                                    <span class="tooltiptext">Hủy</span>
                                </div>
                            </td>
                            <td style="width: 10%"><i class="eye-icon ti-eye" onclick="showDetail(${i}, ${j})"></i></td>
                        </tr>`
            }
        }
    }
    htmls += '</table>';
    document.querySelector('#Order').innerHTML = htmls;
    localStorage.setItem('account', JSON.stringify(arrUser));
}
renderOder()

function duyet(i, j, duyetDon) {
    const arrUser = localStorage.getItem('account') ? JSON.parse(localStorage.getItem('account')) : accounts;

    if(duyetDon) {
        arrUser[i].donhang[j].trangthai = 'Đã xử lý';
    }
    else {
        const notifyDelete1 = document.querySelectorAll('.notify__delete')[1];
        if(arrUser[i].donhang[j].trangthai == 'Đã xử lý') {
            notifyDelete1.innerHTML = `<div class="notify__delete-text">
                                            Không thể hủy đơn hàng đã xử lý !!
                                        </div>
                                        <div class="notify__delete-btn" style="justify-content: flex-end;">
                                            <div class="notify__delete-ok">
                                                OK
                                            </div>
                                        </div>`
            notifyDelete1.style.transform = 'translate(-50%, 0)';
            notifyDelete1.style.opacity = '1';

            document.querySelector('.notify__delete-ok').onclick = function() {
                notifyDelete1.style.transform = 'translate(-50%, -270%)';
                notifyDelete1.style.opacity = '0';
            }
        }
        else {
            notifyDelete1.innerHTML = `<div class="notify__delete-text">
                                            Bạn có chắc muốn hủy đơn hàng này không?
                                        </div>
                                        <div class="notify__delete-btn">
                                            <div class="notify__delete-ok">
                                                OK
                                            </div>
                                            <div class="notify__delete-cancel">
                                                Hủy
                                            </div>
                                        </div>`
        
            notifyDelete1.style.transform = 'translate(-50%, 0)';
            notifyDelete1.style.opacity = '1';
            document.querySelector('.notify__delete-ok').onclick = function() {
                notifyDelete1.style.transform = 'translate(-50%, -270%)';
                notifyDelete1.style.opacity = '0';
        
                arrUser[i].donhang.splice(j, 1);

                localStorage.setItem('account', JSON.stringify(arrUser));
                renderOder();
            }
        
            document.querySelector('.notify__delete-cancel').onclick = function() {
                notifyDelete1.style.transform = 'translate(-50%, -270%)';
                notifyDelete1.style.opacity = '0';
            }
        }
    }

    localStorage.setItem('account', JSON.stringify(arrUser));

    renderOder();
    renderThongKe();
}

var overlayOrder = document.querySelector('.overlay.order');
function showDetail(i, j) {
    overlayOrder.style.transform = 'scale(1)';

    const arrUser = localStorage.getItem('account') ? JSON.parse(localStorage.getItem('account')) : accounts;
    var listProduct = arrUser[i].donhang[j].sanpham;
    var listOrder = arrUser[i].donhang[j];
    var listUser = arrUser[i];

    var tmp = '';
    for(let k=0; k < listProduct.length; k++) {
        tmp += `<li>[${listProduct[k].amount}] x ${listProduct[k].name} (${listProduct[k].size})</li>`
    }

    document.querySelector('.detail__monan').innerHTML = tmp;
    document.querySelector('.detail__ngaytaodon').innerText = listOrder.ngaymua;
    document.querySelector('.detail__khachhang').innerText = listUser.Fullname;
    document.querySelector('.detail__email').innerText = listUser.email;
    document.querySelector('.detail__diachi').innerText = listOrder.address;
    document.querySelector('.detail__dienthoai').innerText = listOrder.phone;
    document.querySelector('.detail__tongtien').innerText = listOrder.tongtien;
    if(listOrder.ghichu == '') {
        listOrder.ghichu = 'Không có';
    }
    document.querySelector('.detail__ghichu').innerText = listOrder.ghichu;
    document.querySelector('.detail__trangthai').innerText = listOrder.trangthai;

    localStorage.setItem('account', JSON.stringify(arrUser));
}

document.getElementById('detail__confirm').onclick = function() {
    document.querySelector('.overlay.order').style.transform = 'scale(0)';
}

const dsMonAn = document.querySelector('.detail__monan');
document.querySelector('.monan').onclick = function() {
    var tmp = dsMonAn.offsetHeight + 'px';
    if(tmp == '0px') {
        dsMonAn.style.maxHeight = '141px';
        document.querySelector('.monan i').classList.remove('fa-arrow-down');
        document.querySelector('.monan i').classList.add('fa-arrow-up');
        document.querySelector('.monan').style.maxHeight = '141px';
        document.querySelector('.monan').style.overflow = 'auto';
    }
    else {
        dsMonAn.style.maxHeight = '0px';
        document.querySelector('.monan i').classList.remove('fa-arrow-up');
        document.querySelector('.monan i').classList.add('fa-arrow-down');
        document.querySelector('.monan').style.maxHeight = '0px';
        document.querySelector('.monan').style.overflow = 'auto';
    }
}

// Lọc đơn hàng theo ngày
function locDonHangTheoKhoangNgay() {
    var from = document.getElementById('fromDate').value;
    var to = document.getElementById('toDate').value;
    var valueConfirm = document.getElementById('actionConfirm').value;
    if (from === '' || to === '') {
        alert('Vui lòng nhập đầy đủ ngày tháng năm')
        clearDay();
        return;
    }
    alert(typeof to)
    from = new Date(from);
    to = new Date(to);
    alert(typeof to)
    if (from > to) {
        alert("khoảng thời gian không hợp lệ")
        clearDay();
        return;
    }
    var listTr_table = document.querySelector('.section__order').querySelector('.table-content').getElementsByTagName('tr');
    for (var tr of listTr_table) {
        var td = parseYMD(tr.getElementsByTagName('td')[1].innerHTML);
        var td2 = tr.getElementsByTagName('td')[4].innerHTML;
        var d = new Date(td)
        if (valueConfirm === "Tất Cả") {
            if (d >= from && d <= to) {
                tr.style.display = '';
            } else {
                tr.style.display = 'none';
            }
        }
        if (valueConfirm === "Chưa xử lý") {
            if (d >= from && d <= to && td2 === "Chưa xử lý") {
                tr.style.display = '';
            } else {
                tr.style.display = 'none';
            }
        }
        if (valueConfirm === "Đã xử lý") {
            if (d >= from && d <= to && td2 === "Đã xử lý") {
                tr.style.display = '';
            } else {
                tr.style.display = 'none';
            }
        }
    }
}

// Xóa tìm kiếm trong đơn hàng
var deleteSearchDay = document.querySelector('.deleteSearchDay');
deleteSearchDay.addEventListener('click', function() {
    document.getElementById('fromDate').value = '';
    document.getElementById('toDate').value = '';
    document.getElementById('actionConfirm').value = 'Tất cả';
    renderOder();
})



// ==> XỬ LÝ THỐNG KÊ
function renderThongKe() {
    const arr = localStorage.getItem('account') ? JSON.parse(localStorage.getItem('account')) : accounts;
    var tongDonHang = 0;
    var tongSP = 0;
    for(let i=1; i < arr.length; i++) {
        for(let j = 0; j < arr[i].donhang.length; j++) {
            if(arr[i].donhang[j].trangthai === 'Đã xử lý') {
                tongDonHang++;
                tongSP += arr[i].donhang[j].sanpham.length;
            }
        }
    }

    document.querySelectorAll('.material-symbols-rounded')[0].innerHTML = tongDonHang;
    document.querySelector('.sanPhamDaBan').innerHTML = tongSP;
}
renderThongKe()

function getSubTotal() {
    let listCart = JSON.parse(localStorage.getItem('carts'));
    let listProductByCategory = ["Bento", "Sushi", "Sashimi", "Combo Sashimi", "Món ăn kèm", "Nước uống và tráng miệng"];
    let listSoldOut = Array(7).fill(0);
    for (let j = 1; j < listCart.length; j++) {
        for (let i = 0; i < listCart[j].length; i++) {
            if (listCart[j][i].status == "Đã xử lý") {
                switch (listCart[j][i].category) {
                    case "Bento": {
                        listSoldOut[0] += parseFloat(listCart[j][i].price.split('£')[1]) * listCart[j][i].soluong;
                        break;
                    }
                    case "Sushi": {
                        listSoldOut[1] += parseFloat(listCart[j][i].price.split('£')[1]) * listCart[j][i].soluong;
                        break;
                    }
                    case "Sashimi": {
                        listSoldOut[2] += parseFloat(listCart[j][i].price.split('£')[1]) * listCart[j][i].soluong;
                        break;
                    }
                    case "Combo Sashimi": {
                        listSoldOut[6] += parseFloat(listCart[j][i].price.split('£')[1]) * listCart[j][i].soluong;
                        break;
                    }
                    case "Món ăn kèm": {
                        listSoldOut[3] += parseFloat(listCart[j][i].price.split('£')[1]) * listCart[j][i].soluong;
                        break;
                    }
                    case "Nước uống và tráng miệng": {
                        listSoldOut[4] += parseFloat(listCart[j][i].price.split('£')[1]) * listCart[j][i].soluong;
                        break;
                    }
                }
            }
        }
    }
    for (let i = 0; i < 6; i++) {
        listSoldOut[i] = listSoldOut[i].toFixed(2);
    }
    return listSoldOut;
}

function parseYMD(string) {
    let arr = string.split("-");
    if (arr[0] < 10) {
        arr[0] = `0${arr[0]}`;
    }
    return arr[2] + "-" + arr[1] + "-" + arr[0]
}

function dateFilter_statistic(date) {
    let d1 = document.getElementById("date-from1").value
    let d2 = document.getElementById("date-to1").value
    const dateFormat = parseYMD(date);
    return dateFormat>= d1 && dateFormat<=d2;
}

function statisticFilter() {
    const arr = localStorage.getItem('account') ? JSON.parse(localStorage.getItem('account')) : accounts;
    const newBillArr = [];
    let billArr = []
    let d1 = document.getElementById("date-from1")
    let d2 = document.getElementById("date-to1")
    if(d1.value > d2.value && d2.value != "") {
        alert("SAI THỨ TỰ NGÀY !") 
        d1.focus()
        d2.focus()
    }
    else { 
        billArr = arr.map((product) => {
            const donHang = product?.donhang?.filter((hang) => {
                return dateFilter_statistic(hang.ngaymua);
            })

            return donHang;
        })

        billArr = billArr.filter((bill) => bill)


        billArr.forEach((bill) => newBillArr.push(...bill));
    }

    
    if (newBillArr.length <= 0) {
        billArr = arr.map((product) => {
            return product?.donhang;
        })

        billArr = billArr.filter((bill) => bill)

        billArr.forEach((bill) => newBillArr.push(...bill));

    }

    var newBillArr2 = [];

    for(let i=0; i < newBillArr.length; i++) {
        if(newBillArr[i].trangthai === "Đã xử lý") {
            newBillArr2.push(newBillArr[i])
        }
    }

    statisticFilter_Brand(newBillArr2);
    
}

statisticFilter();

// Tính thành tiền của từng sản phẩm
function tinhThanhTien(price, size, amount) {
    return parseInt(amount * (deleteComma(price) + parseInt(size === 'S' ? 0 : (size === 'M' ? 20000 : 50000))))
}

function renderStatistic(billarr) {
    let totalprice = 0;
    const billHTML = billarr.map((bill) => {
        var sum = tinhThanhTien(bill.price, bill.size, bill.amount)
        totalprice += sum;
        return `
        <div class="statistic-content-prd">
            <div class="statistic-content-prd-id">
                <span>${bill.masp}</span>
            </div>
            <div class="statistic-content-prd-name">
                <div>
                    <img src="${bill.image}" alt="">
                </div>
                <span>${bill.name}</span>
            </div>
            <div class="statistic-content-prd-amount">
                <span>${bill.amount}</span>
            </div>
            <div class="statistic-content-price">
                ${addComma(sum)}
            </div>
        </div> 
    `
    }).join("");

    document.getElementById('statistic-perform').innerHTML = billHTML;
    document.getElementById('totalprice').innerHTML = `${addComma(totalprice)} ₫`;
}

function statisticFilter_Brand(billarr) {
    let brand = document.getElementById('statistic-brand-filter').value
    const sanphamList = [];

    billarr.forEach((bill) => sanphamList.push(...bill.sanpham));

    switch (brand) {
        case "bento":
            const bentoFilter = sanphamList.filter((sp) => sp.type === 'bento');
            renderStatistic(bentoFilter);
            break;
        case "sushi":
            const sushiFilter = sanphamList.filter((sp) => sp.type === 'sushi');
            renderStatistic(sushiFilter);
            break;
        case "sashi":
            const sashiFilter = sanphamList.filter((sp) => sp.type === 'sashi');
            renderStatistic(sashiFilter);
            break;
        case "combo":
            const comboFilter = sanphamList.filter((sp) => sp.type === 'combo');
            renderStatistic(comboFilter);
            break;
        case "bento":
            const billFilter = sanphamList.filter((sp) => sp.type === 'bento');
            renderStatistic(billFilter);
            break;
        case "ankem":
            const ankemFilter = sanphamList.filter((sp) => sp.type === 'ankem');
            renderStatistic(ankemFilter);
            break;
        case "douong":
            const douongFilter = sanphamList.filter((sp) => sp.type === 'douong');
            renderStatistic(douongFilter);
            break;
        default:
            renderStatistic(sanphamList);
            break;
    }
}

showProduct();

}
else {
    document.getElementById('main').innerHTML = `
    <div style="font-size: 60px;
    color: red;
    font-weight: bold;
    line-height: 80px;
    margin-top: 140px;
    text-align: center;">Không phải thầy Sang thì đừng vào...</div>`
}